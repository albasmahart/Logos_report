<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
	<meta charset="UTF-8">
	<title>جدول تقرير الإنجاز</title>
	<style>

		#overall_progress {
    flex: 1;
    text-align: center;
}
		@font-face {
			font-family: 'Bahij TheSansArabicSemiLight';
			src: url('BahijTheSansArabic-SemiLight.ttf') format('truetype');
			font-weight: normal;
			font-style: normal;
		}
		body {
			background: linear-gradient(135deg, #f7f9fb 60%, #eaf3fa 100%);
			font-family: 'Bahij TheSansArabicSemiLight', Arial, sans-serif;
			color: #1d1d1d;
			margin: 0;
			padding: 0;
		}
		.container {
			max-width: 1100px;
			margin: 40px auto;
			padding: 32px 24px;
			background: #fff;
			border-radius: 18px;
			box-shadow: 0 4px 24px rgba(29,112,183,0.10);
			position: relative;
		}
.header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 24px;
}
		.logo {
			height: 64px;
			width: auto;
			border-radius: 14px;
			box-shadow: 0 2px 12px #1d70b733;
			background: #fff;
			padding: 4px 12px;
			margin-left: 12px;
			transition: box-shadow 0.3s;
		}
		.logo:hover {
			box-shadow: 0 4px 24px #1d70b799;
		}
		h1 {
			color: #1d70b7;
			text-align: right;
			font-size: 2.5em;
			letter-spacing: 1px;
			font-weight: bold;
			font-family: 'Bahij TheSansArabicSemiLight', Arial, sans-serif;
			margin: 0;
		}
		table {
			width: 100%;
			border-collapse: collapse;
			border-spacing: 0;
			background: #fff;
			border-radius: 14px;
			overflow: hidden;
			box-shadow: 0 2px 8px rgba(29,112,183,0.07);
		}
		th, td {
			padding: 16px 10px;
			text-align: center;
			font-size: 1.08em;
			transition: background 0.2s;
		}
		td.note-col {
			min-width: 220px;
			max-width: 400px;
			width: 28%;
			text-align: right;
			font-size: 1.08em;
		}
		th {
			background: linear-gradient(90deg, #1560a7 0%, #1d70b7 60%, #3fa7f5 100%);
			color: #fff !important;
			font-weight: bold;
			border-bottom: 3px solid #f29100;
			letter-spacing: 0.5px;
			box-shadow: 0 2px 8px #1d70b733;
			border-top-left-radius: 14px;
			border-top-right-radius: 14px;
		}
		tr:nth-child(even) td {
			background: #f6faff;
		}
		tr:hover td {
			background: #f2910022;
			color: #1d70b7;
		}
		.progress-bar {
			background: #eaeaea;
			border-radius: 8px;
			height: 18px;
			width: 100px;
			margin: auto;
			position: relative;
			box-shadow: 0 1px 4px #f2910033;
		}
		.progress {
			background: linear-gradient(90deg, #f29100 60%, #1d70b7 100%);
			height: 100%;
			border-radius: 8px;
			transition: width 0.5s;
		}
		td, th {
			color: #1d1d1d;
			font-family: 'Bahij TheSansArabicSemiLight', Arial, sans-serif;
		}
		.note {
			color: #868686;
			font-size: 0.98em;
			font-style: italic;
		}
		@media (max-width: 700px) {
			.container { padding: 8px; }
			table, th, td { font-size: 0.95em; }
			h1 { font-size: 1.3em; }
			.header { flex-direction: column; gap: 12px; }
			.logo { height: 48px; margin-left: 0; }
		}
		@media print {
    body {
        background: #fff !important;
        color: #1d1d1d !important;
    }
    .container {
        box-shadow: none !important;
        border-radius: 0 !important;
        padding: 0 !important;
        margin: 0 !important;
        max-width: 100% !important;
    }
    .header {
        margin-bottom: 18px !important;
        justify-content: flex-start !important;
    }
    h1 {
        color: #1d70b7 !important;
        font-size: 2em !important;
        margin-bottom: 0.5em !important;
        text-align: right !important;
    }
    button {
        display: none !important;
    }
    table {
        width: 100% !important;
        font-size: 1em !important;
        border-radius: 0 !important;
        box-shadow: none !important;
        margin: 0 !important;
    }
    th {
        background: #1d70b7 !important;
        color: #fff !important;
        font-size: 1.05em !important;
        border-bottom: 2px solid #f29100 !important;
        padding: 10px 6px !important;
    }
    td {
        padding: 10px 6px !important;
        font-size: 1em !important;
        color: #222 !important;
        background: #fff !important;
        border-bottom: 2px solid #eaf3fa !important;
    }
    tr:nth-child(even) td {
        background: #f7f7fa !important;
    }
    .progress-bar, .progress {
        box-shadow: none !important;
        border-radius: 6px !important;
        height: 14px !important;
        width: 80px !important;
    }
    .progress {
        background: #1d70b7 !important;
    }
    .note {
        color: #868686 !important;
        font-size: 0.95em !important;
        font-style: italic !important;
    }
    .note-col {
        text-align: right !important;
        font-size: 1em !important;
    }
    .container, .header, .progress-bar, .progress, .note-col {
        page-break-inside: avoid !important;
    }
}
	</style>
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<script type="text/javascript">
		google.charts.load('current', {'packages':['table']});
		google.charts.setOnLoadCallback(drawTable);

		function drawTable() {
			var sheetId = '1dH4YKk5Qk8Rc7A3ZIP6QOsDqIgoUrcCZQrvYKZNyZws';
			var gid = '1818940627';
			var url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&gid=${gid}`;

			fetch(url)
				.then(res => res.text())
				.then(rep => {
					var json = JSON.parse(rep.substr(47).slice(0, -2));
					var rows = json.table.rows;
					var data = [];
					var numbering = 1;

					rows.forEach(row => {
						if (row.c[1] && row.c[1].v && row.c[1].v.trim() !== "") {
							function boolIcon(val) {
								if (val === true || val === "true") {
									return '<span style="color:#1d70b7;font-size:1.3em;font-weight:bold">✔</span>';
								} else {
									return '<span style="color:#e53935;font-size:1.3em;font-weight:bold">✖</span>';
								}
							}
							let done = 0;
							if (row.c[2] && (row.c[2].v === true || row.c[2].v === "true")) done++;
							if (row.c[3] && (row.c[3].v === true || row.c[3].v === "true")) done++;
							if (row.c[4] && (row.c[4].v === true || row.c[4].v === "true")) done++;
							let percent = Math.round((done / 3) * 100);
							function formatSheetDate(val) {
								if (!val) return '';
								let match = /Date\((\d+),(\d+),(\d+),(\d+),(\d+),(\d+)\)/.exec(val);
								if (match) {
									let year = match[1];
									let month = (parseInt(match[2]) + 1).toString().padStart(2, '0');
									let day = match[3].padStart(2, '0');
									let hour = match[4].padStart(2, '0');
									let min = match[5].padStart(2, '0');
									let sec = match[6].padStart(2, '0');
									let ampm = (parseInt(hour) < 12) ? 'AM' : 'PM';
									return `${ampm} ${hour}:${min}:${sec}<br>${year}/${month}/${day}`;
								}
								return val;
							}
							data.push([
								numbering++,
								row.c[1] ? row.c[1].v : '',
								boolIcon(row.c[2] ? row.c[2].v : false),
								boolIcon(row.c[3] ? row.c[3].v : false),
								boolIcon(row.c[4] ? row.c[4].v : false),
								`<span class="note">${row.c[5] ? row.c[5].v : ''}</span>`,
								row.c[6] ? formatSheetDate(row.c[6].v) : '',
								`<div class="progress-bar"><div class="progress" style="width:${percent}%"></div></div>
								 <span>${percent}%</span>`
							]);
						}
					});

					// حساب نسبة الإنجاز الكلية بناءً على عمود "نسبة الإنجاز"
					var totalPercent = 0;
					data.forEach(row => {
						var percentMatch = row[7].match(/(\d+)%/);
						if (percentMatch) {
							totalPercent += parseInt(percentMatch[1], 10);
						}
					});
					var overallPercent = data.length > 0 ? Math.round(totalPercent / data.length) : 0;
					// حذف الشعار من progressBarHtml
					var progressBarHtml = `<div style='margin-bottom:24px;text-align:center;'><div class='progress-bar' style='width:220px;display:inline-block;vertical-align:middle;'><div class='progress' style='width:${overallPercent}%;'></div></div> <span style='font-size:1.15em;color:#1d70b7;font-weight:bold;vertical-align:middle;margin-right:8px;'>نسبة الإنجاز الكلية: ${overallPercent}%</span></div>`;
		
					var tableHtml = `<table>
						<thead>
							<tr>
								<th>الترقيم</th>
								<th>الإسم</th>
								<th>تصميم الشعار</th>
								<th>تصميم الهوية</th>
								<th>طباعة الهوية</th>
								<th style="width:28%">الملاحظة الحالية</th>
								<th style="width:10%">آخر تحديث</th>
								<th>نسبة الإنجاز</th>
							</tr>
						</thead>
						<tbody>
							${data.map(row => `<tr>${row.map((cell, i) => i === 5 ? `<td class='note-col'>${cell}</td>` : `<td>${cell}</td>`).join('')}</tr>`).join('')}
						</tbody>
					</table>`;
					document.getElementById('overall_progress').innerHTML = progressBarHtml;
					document.getElementById('table_div').innerHTML = tableHtml;
				});
		}

		setInterval(drawTable, 60000);


	</script>
</head>
<body>
	<div class="container">
    <div class="header">
        <h1>جدول تقرير الإنجاز</h1>
        <div id="overall_progress" style="flex:1;text-align:center;"></div>
        <button onclick="window.print()" style="background:linear-gradient(90deg,#1d70b7 60%,#3fa7f5 100%);color:#fff;font-family:'Bahij TheSansArabicSemiLight',Arial,sans-serif;font-size:1.08em;padding:8px 22px;border:none;border-radius:10px;box-shadow:0 2px 8px #1d70b733;cursor:pointer;transition:background 0.2s;margin-right:12px;">🖨️ طباعة التقرير</button>
    </div>
    <div id="table_div"></div>
</div>
</body>
</html>
